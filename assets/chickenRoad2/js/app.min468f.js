class ChickenRoadGame{constructor(){this.game=document.getElementById("game"),this.char=document.getElementById("game-char"),this.field=document.getElementById("game-field"),this.sectors=document.querySelectorAll(".game__sector"),this.spinButton=document.getElementById("go-btn"),this.cashButton=document.getElementById("cash-btn"),this.winButton=document.getElementById("win-button-modal"),this.modal=document.getElementById("modal"),this.controls=document.getElementById("game-controls"),this.balance=document.getElementById("balance"),this.modalBalance=document.getElementById("modal-balance"),this.modalMultiplier=document.getElementById("modal-multiplier"),this.charMultiplier=document.getElementById("char-multiplier"),this.charMultiplierElement=document.getElementById("char-multiplier-element"),this.effectsContainer=document.getElementById("effects"),this.effectsImage=document.getElementById("effects-image"),this.spinSound=new Audio("../../assets/general/sound/chicken-road-2-button-click.mp3"),this.jumpSound=new Audio("../../assets/general/sound/chicken-road-2-jump.mp3"),this.cashOutSound=new Audio("../../assets/general/sound/chicken-road-2-cahout.mp3"),this.winSound=new Audio("../../assets/general/sound/chicken-road-2-win.mp3"),this.rate=document.getElementById("rate").dataset.rate,this.multipliers=document.getElementById("rate").dataset.multipliers,this.sectorWidth=this.sectors[0].offsetWidth,this.charMoves=0,this.currentStep=0,this.firstStepIndex=1,this.lastStepIndex=7,this.stepTime=700,this.spaceScrolled=window.innerWidth,this.isDesktop=window.innerWidth>768}initGame(){this.showNextSector(this.currentStep),this.calculateFontSize(this.spinButton),this.calculateFontSize(this.cashButton),this.calculateFontSize(this.winButton,{threshold:30,step:.02,minPercent:.6}),window.addEventListener("placementOpenModal",()=>{this.showModal()}),this.spinButton.addEventListener("click",()=>{this.initSpin()}),this.cashButton.addEventListener("click",()=>{this.showEffects(),this.triggerShowModal(),this.playSound(this.cashOutSound),this.disableControls(1e4)})}initSpin(){window.isMobile&&window.pushPlacement&&!window.firstClick&&0===this.currentStep?window.dispatchEvent(new CustomEvent("placementFirstClick",{detail:[this.spin.bind(this)]})):this.spin()}spin(){this.currentStep+=1,this.playSound(this.spinSound),this.isDesktop&&(this.currentStep===this.firstStepIndex||this.currentStep===this.lastStepIndex||this.spaceScrolled>this.field.offsetWidth)&&(this.charMoves+=1),this.playSound(this.jumpSound,100),this.moveChar(this.currentStep),this.moveField(this.currentStep),this.disableControls(this.stepTime),setTimeout(()=>{this.showNextSector(this.currentStep),this.showActiveSector(this.currentStep),this.showFinishedSector(this.currentStep),this.updateBalance(this.currentStep),this.updateMultiplier(this.currentStep)},this.stepTime/2),this.currentStep===this.firstStepIndex&&(this.setControlPanelActivated(),setTimeout(()=>{this.showCharMultiplier()},this.stepTime)),this.currentStep===this.lastStepIndex&&(setTimeout(()=>{this.hideCharMultiplier()},this.stepTime/2),setTimeout(()=>{this.charMoves+=1.3,this.moveChar(this.currentStep+1.3),this.moveField(this.currentStep+1.3),this.showFinishedSector(this.currentStep+1),this.showEffects(1e3),this.playSound(this.winSound,1e3),this.triggerShowModal(1e3),this.disableControls(1e4)},this.stepTime))}calculateFontSize(t,e={threshold:25,step:.03,minPercent:.6}){if(!t)return;const s=t.querySelectorAll("span");s&&s.forEach(t=>{const s=String(t.innerText).length,i=window.getComputedStyle(t),n=parseFloat(i.getPropertyValue("font-size")),o=n,h=n*e.minPercent,a=Math.max(0,s-e.threshold),c=Math.max(o-a*(n*e.step),h);t.style.fontSize=`${c}px`})}showNextSector(t){const e=this.sectors[t];e&&e.classList.add("is--next")}showActiveSector(t){const e=this.sectors[t-1];e&&(e.classList.add("is--active"),e.classList.remove("is--next"))}showFinishedSector(t){const e=this.sectors[t-2];e&&(e.classList.add("is--finished"),e.classList.remove("is--next"),e.classList.remove("is--active"))}showCharMultiplier(){this.charMultiplierElement.classList.add("is--active")}hideCharMultiplier(){this.charMultiplierElement.classList.remove("is--active")}moveField(t){const e=this.sectorWidth*(t-this.charMoves);this.field.style.transform=`translateX(-${e}px)`,this.spaceScrolled+=e}moveChar(t){if(this.char.classList.add("is--active"),t===this.firstStepIndex||t>=this.lastStepIndex||this.spaceScrolled>this.field.offsetWidth){const t=this.sectorWidth*this.charMoves;this.char.style.transform=`translateX(${t}px)`}setTimeout(()=>{this.char.classList.remove("is--active")},this.stepTime)}setControlPanelActivated(){this.controls.classList.add("is--active")}updateBalance(t){const e=this.multipliers.split(","),s=(this.rate*e[t-1]).toFixed(2);this.balance.innerText=s,this.modalBalance.innerText=s}updateMultiplier(t){const e=this.multipliers.split(",");this.modalMultiplier.innerText=e[t-1],this.charMultiplier.innerText=e[t-1]}disableControls(t){this.spinButton.setAttribute("disabled",""),t&&setTimeout(()=>{this.spinButton.removeAttribute("disabled")},t)}showEffects(t=0,e=1500){this.effectsContainer.classList.add("visible"),setTimeout(()=>{const t=document.createElement("div");t.style.backgroundImage=`url(${this.effectsImage.src})`,t.classList.add("effects__block"),this.effectsContainer.appendChild(t),setTimeout(()=>{this.effectsContainer.classList.remove("visible"),this.effectsContainer.classList.add("hidden")},e)},t)}showModal(){document.body.classList.add("is--modal-open"),this.modal.classList.add("is--active")}playSound(t,e=0){setTimeout(()=>{t.muted=!1,t.currentTime=0,t.play().catch(t=>{console.error("Помилка при відтворенні аудіо: ",t)})},e)}triggerShowModal(t=0){setTimeout(()=>{window.dispatchEvent(new Event("placementOpenModal"))},t)}}document.addEventListener("DOMContentLoaded",()=>{(new ChickenRoadGame).initGame()});